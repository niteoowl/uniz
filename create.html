<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>새 토론 생성 - 디리토</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Quill Rich Text Editor CSS -->
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
    <style>
        @font-face {
            font-family: 'Pretendard-Regular';
            src: url('https://fastly.jsdelivr.net/gh/Project-Noonnu/noonfonts_2107@1.1/Pretendard-Regular.woff') format('woff');
            font-weight: 400;
            font-style: normal;
        }
        body {
            font-family: 'Pretendard-Regular', 'Inter', sans-serif; /* Pretendard 폰트 적용 */
            background-color: #f0f2f5; /* 밝은 회색 배경 */
        }
        /* 고정 헤더를 위한 스타일 */
        .fixed-header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 64px; /* 헤더 높이 고정 */
            z-index: 1000; /* 다른 요소 위에 오도록 설정 */
        }
        /* 고정 사이드바를 위한 스타일 */
        .fixed-sidebar {
            position: fixed;
            top: 64px; /* 헤더 높이만큼 아래로 시작 */
            left: 0;
            bottom: 0;
            width: 16rem; /* w-64 (256px)와 동일 */
            background-color: #ffffff;
            border-right: 1px solid #d1d5db;
            z-index: 999; /* 헤더보다 약간 아래 */
            display: none; /* 모바일에서는 기본 숨김 */
            flex-direction: column;
            justify-content: space-between;
            padding: 1.5rem; /* p-6과 동일 */
        }
        /* 대형 화면 (lg)에서 사이드바 표시 */
        @media (min-width: 1024px) {
            .fixed-sidebar {
                display: flex;
            }
        }

        /* 메인 콘텐츠 영역이 헤더와 사이드바/하단 내비게이션 바를 피하도록 조정 */
        .main-content-area {
            margin-top: 64px; /* 헤더 높이만큼 위쪽 마진 */
            flex: 1;
            overflow-y: auto;
            background-color: #ffffff;
            padding-left: 0; /* 모바일에서 좌우 패딩을 0으로 완전히 제거 */
            padding-right: 0; /* 모바일에서 좌우 패딩을 0으로 완전히 제거 */
            margin-left: 0; /* 모바일에서는 왼쪽 마진 없음 */
            padding-bottom: 4rem; /* 하단 내비게이션 바 높이에 맞춰 패딩 조정 */
        }
        /* 대형 화면 (lg)에서 메인 콘텐츠 영역 왼쪽 마진 조정 */
        @media (min-width: 1024px) {
            .main-content-area {
                margin-left: 16rem; /* 사이드바 너비만큼 왼쪽 마진 */
                padding: 2rem; /* 데스크톱에서는 패딩을 2rem (32px)으로 유지 */
                padding-bottom: 2rem; /* 데스크톱에서는 하단 패딩 줄임 */
            }
        }

        /* 캐러셀 아이템이 줄바꿈되지 않도록 */
        .carousel-item {
            flex: 0 0 auto; /* 아이템이 축소되거나 확장되지 않도록 고정 */
            width: 140px; /* 모바일: 아이템 너비 고정 */
            margin-right: 16px; /* 아이템 간 간격 */
        }
        .carousel-item:last-child {
            margin-right: 0; /* 마지막 아이템에는 마진 없음 */
        }
        .carousel-item img {
            width: 140px; /* 모바일: 이미지 너비 고정 */
            height: 180px; /* 모바일: 이미지 높이 고정 */
            object-fit: cover;
            border-radius: 0.375rem; /* rounded-md */
            margin-bottom: 0.5rem; /* mb-2 */
            margin-left: auto;
            margin-right: auto;
        }

        /* PC (lg) 화면에서 캐러셀 아이템 크기 */
        @media (min-width: 1024px) {
            .carousel-item {
                width: 160px; /* PC: 아이템 너비 원래대로 */
            }
            .carousel-item img {
                width: 160px; /* PC: 이미지 너비 원래대로 */
                height: 224px; /* PC: 이미지 높이 원래대로 */
            }
        }

        /* 캐러셀 버튼 위치 및 크기 조정 */
        .carousel-nav-button {
            position: absolute;
            top: 90px; /* 모바일: 이미지 높이(180px)의 절반 */
            transform: translateY(-50%); /* 정확한 중앙 정렬을 위해 버튼 자체 높이의 절반만큼 위로 이동 */
            background-color: #ffffff; /* 불투명 흰색 배경 */
            border: 1px solid #d1d5db; /* 회색 테두리 */
            border-radius: 9999px; /* 완전한 원형 */
            padding: 0.625rem; /* 10px */
            cursor: pointer;
            transition: background-color 0.2s ease-in-out, opacity 0.3s ease-in-out; /* 불투명도 전환 추가 */
            width: 48px; /* 32px(svg) + 8px(padding) * 2 = 48px */
            height: 48px; /* 동일하게 설정 */
            display: none; /* 모바일에서는 기본 숨김 */
            align-items: center;
            justify-content: center;
            pointer-events: auto; /* 기본적으로 클릭 가능 */
        }
        /* 대형 화면 (lg)에서 캐러셀 버튼 표시 및 위치 조정 */
        @media (min-width: 1024px) {
            .carousel-nav-button {
                display: flex;
                top: 112px; /* PC: 이미지 높이(224px)의 절반 */
            }
        }

        .carousel-nav-button.left-2 {
            left: -24px; /* 버튼 너비(48px)의 절반만큼 왼쪽으로 이동 */
        }
        .carousel-nav-button.right-2 {
            right: -24px; /* 버튼 너비(48px)의 절반만큼 오른쪽으로 이동 */
        }
        .carousel-nav-button:hover {
            background-color: #f3f4f6; /* hover 시 약간 어둡게 */
        }
        .carousel-nav-button svg {
            width: 1.75rem; /* 28px */
            height: 1.75rem; /* 동일하게 설정 */
            color: #4b5563; /* text-gray-600과 동일 */
        }
        /* 스크롤 불가능 시 버튼 숨김 */
        .carousel-nav-button.hidden-button {
            opacity: 0;
            pointer-events: none; /* 클릭 불가능하게 */
        }
        /* 선택된 사이드바 항목 스타일 */
        .selected-nav-item {
            color: #2563eb; /* text-blue-600 */
            background-color: #eff6ff; /* bg-blue-50 */
        }
        /* 선택된 항목의 호버 효과는 없애거나 다르게 설정 (선택된 상태 유지) */
        .selected-nav-item:hover {
            background-color: #eff6ff; /* 선택된 상태의 배경색 유지 */
            color: #2563eb; /* 선택된 상태의 텍스트 색상 유지 */
        }

        /* 캐러셀 스크롤바 숨기기 */
        .flex.overflow-x-scroll::-webkit-scrollbar {
            display: none; /* Webkit (Chrome, Safari) */
        }

        .flex.overflow-x-scroll {
            -ms-overflow-style: none;  /* IE and Edge */
            scrollbar-width: none;  /* Firefox */
        }

        /* 사이드바 항목 호버 효과 제거 */
        .sidebar-nav-item:hover {
            background-color: transparent; /* 호버 시 배경색 변경 없음 */
            color: inherit; /* 호버 시 텍스트 색상 변경 없음 */
        }

        /* 로그인 텍스트 링크 스타일 */
        #login-btn {
            color: #4b5563; /* 기본 텍스트 색상 */
            padding: 0.5rem 1rem; /* 상하 0.5rem, 좌우 1rem 패딩 */
            border-radius: 0.375rem; /* rounded-md */
            font-weight: 500; /* font-medium */
            transition: background-color 0.2s ease-in-out, color 0.2s ease-in-out; /* 부드러운 전환 효과 */
        }

        #login-btn:hover {
            background-color: #f3f4f6; /* 호버 시 투명한 배경처럼 보이는 밝은 회색 */
            color: #1f2937; /* 호버 시 텍스트 색상 약간 진하게 */
        }

        /* 드롭다운 메뉴 스타일 */
        .dropdown-menu {
            position: absolute;
            top: 100%; /* 헤더 바로 아래 */
            right: 0;
            background-color: white;
            border: 1px solid #d1d5db;
            border-radius: 0.375rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            min-width: 160px;
            z-index: 1001; /* 헤더보다 위에 */
            padding: 0.5rem 0;
        }

        .dropdown-menu a {
            display: block;
            padding: 0.75rem 1rem;
            color: #374151;
            font-weight: 500;
            transition: background-color 0.2s ease-in-out;
        }

        .dropdown-menu a:hover {
            background-color: #f3f4f6;
        }

        /* 토글 버튼 커스텀 스타일 */
        .toggle-checkbox {
            position: absolute;
            display: none; /* 기본 HTML 체크박스 숨김 */
        }
        .toggle-label {
            display: block;
            overflow: hidden;
            cursor: pointer;
            border-radius: 9999px; /* 완전한 원형 */
            height: 24px; /* h-6 */
            width: 48px; /* w-12 */
            background-color: #d1d5db; /* bg-gray-300 */
            position: relative;
            transition: background-color 0.2s ease-in-out;
        }
        .toggle-label::before {
            content: "";
            display: block;
            position: absolute;
            top: 2px;
            left: 2px;
            width: 20px; /* 토글 핸들 너비 */
            height: 20px; /* 토글 핸들 높이 */
            background-color: white;
            border-radius: 9999px; /* 완전한 원형 */
            transition: transform 0.2s ease-in-out;
        }
        .toggle-checkbox:checked + .toggle-label {
            background-color: #2563eb; /* bg-blue-600 */
        }
        .toggle-checkbox:checked + .toggle-label::before {
            transform: translateX(24px); /* 핸들을 오른쪽으로 이동 (너비 48px - 핸들 너비 20px - 좌우 패딩 2px*2 = 24px) */
        }

        /* Quill 에디터 높이 조정 */
        #discussion-content-editor {
            height: 200px; /* 내용 에디터 기본 높이 */
        }
        #thumbnail-image-editor {
            height: 100px; /* 썸네일 에디터 기본 높이 */
            border-top: 1px solid #d1d5db; /* 상단 테두리 추가 */
        }
        /* Quill 툴바 스타일 */
        .ql-toolbar.ql-snow {
            border-top-left-radius: 0.375rem; /* rounded-md */
            border-top-right-radius: 0.375rem; /* rounded-md */
            border-bottom: none; /* 아래쪽 테두리 제거 */
            border-color: #d1d5db; /* gray-300 */
        }
        .ql-container.ql-snow {
            border-bottom-left-radius: 0.375rem; /* rounded-md */
            border-bottom-right-radius: 0.375rem; /* rounded-md */
            border-color: #d1d5db; /* gray-300 */
        }
    </style>
</head>
<body class="flex min-h-screen flex-col">

    <header class="fixed-header flex items-center justify-between bg-white p-4 border-b border-gray-300">
        <div class="flex items-center">
            <!-- 로고 이미지를 헤더 높이에 적절히 맞추고 너비는 비율에 따라 자동 조절 -->
            <img src="/image/logo.png" alt="로고" class="h-10 w-auto max-w-full">
        </div>
        <div class="flex items-center space-x-4 relative">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-6 h-6 text-gray-600 cursor-pointer hover:text-blue-500 transition-colors duration-200">
                <path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z" />
            </svg>
            <!-- 로그인 상태에 따라 조건부 렌더링될 요소 -->
            <div id="auth-status-container" class="relative">
                <!-- 여기에 로그인 버튼 또는 닉네임/드롭다운이 들어갑니다. -->
            </div>
        </div>
    </header>

    <div class="flex flex-1">
        <aside class="fixed-sidebar">
            <div>
                <nav>
                    <ul>
                        <li class="mb-2">
                            <a href="#" class="flex items-center p-3 rounded-lg transition-colors duration-200 selected-nav-item">
                                <svg class="w-6 h-6 mr-3" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M4 23V9.66667L13 3L22 9.66667V23H14.125V16.3333H11.875V23H4Z" />
                                </svg>
                                <span class="font-normal">홈</span>
                            </a>
                        </li>
                        <li class="mb-2">
                            <a href="#" class="flex items-center text-gray-700 p-3 rounded-lg transition-colors duration-200 sidebar-nav-item">
                                <svg class="w-6 h-6 mr-3" fill="currentColor" viewBox="0 0 26 26" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M7.21474 18.7853L15.0995 15.1267L18.7581 7.24187L10.8733 10.9005L7.21474 18.7853ZM13 14.0834C12.693 14.0834 12.4357 13.9795 12.2281 13.7719C12.0205 13.5643 11.9166 13.307 11.9166 13C11.9166 12.6931 12.0205 12.4358 12.2281 12.2282C12.4357 12.0205 12.693 11.9167 13 11.9167C13.3069 11.9167 13.5642 12.0205 13.7719 12.2282C13.9795 12.4358 14.0833 12.6931 14.0833 13C14.0833 13.307 13.9795 13.5643 13.7719 13.7719C13.5642 13.9795 13.3069 14.0834 13 14.0834ZM13.0021 24.2161C11.4589 24.2161 10.0054 23.9236 8.64152 23.3387C7.27767 22.7538 6.08623 21.9518 5.06719 20.9328C4.04817 19.9138 3.24621 18.723 2.6613 17.3606C2.07639 15.9982 1.78394 14.5453 1.78394 13.0021C1.78394 11.4409 2.07639 9.97834 2.6613 8.61448C3.24621 7.25063 4.04738 6.06344 5.06481 5.05291C6.08222 4.04238 7.27253 3.24237 8.63572 2.65289C9.99892 2.06342 11.4525 1.76868 12.9966 1.76868C14.5587 1.76868 16.0223 2.06302 17.3873 2.6517C18.7524 3.24039 19.9398 4.03932 20.9496 5.0485C21.9594 6.05767 22.7588 7.24439 23.3478 8.60865C23.9368 9.97291 24.2313 11.4367 24.2313 13C24.2313 14.5446 23.9366 15.9988 23.3471 17.3625C22.7576 18.7262 21.9576 19.9169 20.9471 20.9347C19.9366 21.9524 18.7501 22.7538 17.3876 23.3387C16.0252 23.9236 14.5633 24.2161 13.0021 24.2161ZM13 22.0706C15.523 22.0706 17.6656 21.1883 19.4276 19.4237C21.1896 17.6591 22.0705 15.5179 22.0705 13C22.0705 10.477 21.1896 8.33443 19.4276 6.57245C17.6656 4.81046 15.5205 3.92947 12.9923 3.92947C10.4822 3.92947 8.3442 4.81046 6.57828 6.57245C4.81238 8.33443 3.92942 10.4795 3.92942 13.0077C3.92942 15.5178 4.81173 17.6558 6.57633 19.4217C8.34094 21.1876 10.4822 22.0706 13 22.0706Z" />
                                </svg>
                                <span class="font-normal">탐색</span>
                            </a>
                        </li>
                        <li class="mb-2">
                            <a href="#" class="flex items-center text-gray-700 p-3 rounded-lg transition-colors duration-200 sidebar-nav-item">
                                <svg class="w-6 h-6 mr-3" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.691h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.324 1.118l1.519 4.674c.3.921-.755 1.688-1.539 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.784.57-1.838-.197-1.539-1.118l1.519-4.674a1 1 0 00-.324-1.118L2.05 10.102c-.783-.57-.381-1.81.588-1.81h4.915a1 1 0 00.95-.691l1.519-4.674z" />
                                </svg>
                                <span class="font-normal">베스트</span>
                            </a>
                        </li>
                        <li class="mb-2">
                            <a href="#" class="flex items-center text-gray-700 p-3 rounded-lg transition-colors duration-200 sidebar-nav-item">
                                <svg class="w-6 h-6 mr-3" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M17 3H7a2 2 0 00-2 2v16l7-3.5 7 3.5V5a2 2 0 00-2-2z" />
                                </svg>
                                <span class="font-normal">저장됨</span>
                            </a>
                        </li>
                        <li class="mb-2">
                            <a href="#" class="flex items-center text-gray-700 p-3 rounded-lg transition-colors duration-200 sidebar-nav-item">
                                <svg class="w-6 h-6 mr-3" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M14 2H6C4.9 2 4 2.9 4 4V20C4 21.1 4.9 22 6 22H18C19.1 22 20 21.1 20 20V8L14 2ZM18 20H6V4H13V9H18V20ZM12 11C10.34 11 9 12.34 9 14C9 15.66 10.34 17 12 17C13.66 17 15 15.66 15 14C15 12.34 13.66 11 12 11ZM12 15.5C11.17 15.5 10.5 14.83 10.5 14C10.5 13.17 11.17 12.5 12 12.5C12.83 12.5 13.5 13.17 13.5 14C13.5 14.83 12.83 15.5 12 15.5Z" />
                                </svg>
                                <span class="font-normal">퀘스트</span>
                            </a>
                        </li>
                    </ul>
                </nav>
            </div>
            <div>
            </div>
        </aside>

        <main class="main-content-area px-4 py-8 lg:px-8">
            <div class="max-w-3xl mx-auto bg-white p-6 rounded-lg shadow-md border border-gray-200">
                <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center">새로운 토론 생성</h2>

                <!-- Authentication message display area -->
                <div id="auth-message" class="hidden bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-md mb-4" role="alert">
                    <strong class="font-bold">로그인 필요:</strong>
                    <span class="block sm:inline">토론을 생성하려면 먼저 로그인해야 합니다.</span>
                </div>

                <!-- Form submission message display area -->
                <div id="form-message" class="hidden px-4 py-3 rounded-md mb-4" role="alert">
                    <span class="block sm:inline" id="form-message-text"></span>
                </div>

                <form id="create-discussion-form" class="space-y-6">
                    <div>
                        <label for="discussion-title" class="block text-gray-700 text-sm font-semibold mb-2">제목</label>
                        <input type="text" id="discussion-title" name="title" placeholder="토론 제목을 입력하세요"
                               class="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all duration-200"
                               required>
                    </div>

                    <div>
                        <label for="discussion-category" class="block text-gray-700 text-sm font-semibold mb-2">카테고리</label>
                        <select id="discussion-category" name="category"
                                class="w-full p-3 border border-gray-300 rounded-md bg-white focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all duration-200"
                                required>
                            <option value="">카테고리를 선택하세요</option>
                            <option value="자유 토론">자유 토론</option>
                            <option value="질문">질문</option>
                            <option value="건의">건의</option>
                            <option value="정보 공유">정보 공유</option>
                            <option value="기타">기타</option>
                        </select>
                    </div>

                    <div>
                        <label for="discussion-format" class="block text-gray-700 text-sm font-semibold mb-2">토론 형식</label>
                        <select id="discussion-format" name="format"
                                class="w-full p-3 border border-gray-300 rounded-md bg-white focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all duration-200"
                                required>
                            <option value="">토론 형식을 선택하세요</option>
                            <option value="자유 토론">자유 토론</option>
                            <option value="찬반 토론">찬반 토론</option>
                        </select>
                    </div>

                    <!-- 찬반 토론 선택 시 나타날 옵션들 -->
                    <div id="pro-con-options" class="space-y-6 hidden">
                        <div>
                            <label class="block text-gray-700 text-sm font-semibold mb-2">토론 유형</label>
                            <div class="flex items-center space-x-4">
                                <input type="radio" id="debate-type-team" name="debate_type" value="team" class="form-radio text-blue-600 h-4 w-4" checked>
                                <label for="debate-type-team" class="text-gray-700">팀 토론</label>
                                <input type="radio" id="debate-type-1v1" name="debate_type" value="1v1" class="form-radio text-blue-600 h-4 w-4">
                                <label for="debate-type-1v1" class="text-gray-700">1 vs 1 토론</label>
                            </div>
                        </div>

                        <!-- 팀 토론 선택 시 나타날 옵션 -->
                        <div id="team-members-option" class="hidden">
                            <label for="team-members" class="block text-gray-700 text-sm font-semibold mb-2">팀당 인원</label>
                            <input type="number" id="team-members" name="team_members" placeholder="예: 3" min="1" value="3"
                                   class="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all duration-200">
                        </div>

                        <!-- 토론 절차별 시간 설정 -->
                        <div>
                            <h3 class="text-base font-semibold text-gray-800 mb-3">토론 절차별 시간 설정 (분)</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label for="time-proposition" class="block text-gray-700 text-sm font-medium mb-1">논제 제시</label>
                                    <input type="number" id="time-proposition" name="time_proposition" placeholder="분" min="0" value="2"
                                           class="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all duration-200">
                                </div>
                                <div>
                                    <label for="time-opening" class="block text-gray-700 text-sm font-medium mb-1">입론 (주장 제시)</label>
                                    <input type="number" id="time-opening" name="time_opening" placeholder="분" min="0" value="3"
                                           class="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all duration-200">
                                </div>
                                <div>
                                    <label for="time-rebuttal" class="block text-gray-700 text-sm font-medium mb-1">반론 (논리적 반박)</label>
                                    <input type="number" id="time-rebuttal" name="time_rebuttal" placeholder="분" min="0" value="3"
                                           class="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all duration-200">
                                </div>
                                <div>
                                    <label for="time-final" class="block text-gray-700 text-sm font-medium mb-1">최종 변론</label>
                                    <input type="number" id="time-final" name="time_final" placeholder="분" min="0" value="2"
                                           class="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all duration-200">
                                </div>
                                <div>
                                    <label for="time-jury-judgment" class="block text-gray-700 text-sm font-medium mb-1">배심원 판단</label>
                                    <input type="number" id="time-jury-judgment" name="time_jury_judgment" placeholder="분" min="0" value="5"
                                           class="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all duration-200">
                                </div>
                            </div>
                        </div>
                    </div>

                    <div>
                        <label class="block text-gray-700 text-sm font-semibold mb-2">배심원 참여 여부</label>
                        <div class="flex items-center">
                            <input type="checkbox" id="jury-toggle" name="jury_required_toggle" class="toggle-checkbox" checked>
                            <label for="jury-toggle" class="toggle-label"></label>
                            <span class="ml-3 text-gray-700" id="jury-status">필요함</span>
                            <!-- Hidden input to store the actual value for form submission -->
                            <input type="hidden" id="jury-required-hidden" name="jury_required" value="yes">
                        </div>
                    </div>

                    <div>
                        <label for="discussion-content-editor" class="block text-gray-700 text-sm font-semibold mb-2">내용</label>
                        <!-- Quill 에디터가 렌더링될 div -->
                        <div id="discussion-content-editor" class="bg-white border border-gray-300 rounded-md"></div>
                        <!-- Quill 에디터의 내용을 저장할 hidden input -->
                        <input type="hidden" id="discussion-content-hidden" name="content">
                    </div>

                    <div>
                        <label for="thumbnail-image-editor" class="block text-gray-700 text-sm font-semibold mb-2">썸네일 이미지</label>
                        <!-- 썸네일 이미지 업로드를 위한 Quill 에디터 -->
                        <div id="thumbnail-image-editor" class="bg-white border border-gray-300 rounded-md"></div>
                        <!-- 썸네일 이미지 URL을 저장할 hidden input -->
                        <input type="hidden" id="thumbnail-image-hidden" name="thumbnail_image">
                    </div>

                    <div>
                        <label for="discussion-tags-input" class="block text-gray-700 text-sm font-semibold mb-2">태그 (엔터로 구분)</label>
                        <div id="tags-container" class="flex flex-wrap gap-2 mb-2">
                            <!-- Entered tags will be displayed here -->
                        </div>
                        <input type="text" id="discussion-tags-input" name="tags_input" placeholder="태그를 입력하고 엔터를 누르세요"
                               class="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all duration-200">
                        <!-- Hidden input to store combined tags for form submission -->
                        <input type="hidden" id="discussion-tags-hidden" name="tags">
                    </div>

                    <div class="flex justify-end space-x-4">
                        <button type="button" onclick="window.history.back()"
                                class="px-6 py-3 bg-gray-200 text-gray-800 rounded-md font-medium hover:bg-gray-300 transition-colors duration-200 shadow-sm">
                            취소
                        </button>
                        <button type="submit"
                                class="px-6 py-3 bg-blue-600 text-white rounded-md font-medium hover:bg-blue-700 transition-colors duration-200 shadow-md">
                            토론 생성
                        </button>
                    </div>
                </form>
            </div>
        </main>
    </div>

    <nav class="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-300 py-0.5 px-2 shadow-lg lg:hidden z-1000">
        <ul class="flex justify-around items-center h-full">
            <li>
                <a href="#" class="flex flex-col items-center p-2 rounded-lg text-blue-600">
                    <svg class="w-6 h-6 mb-1" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path d="M4 23V9.66667L13 3L22 9.66667V23H14.125V16.3333H11.875V23H4Z" />
                    </svg>
                    <span class="text-xs font-normal">홈</span>
                </a>
            </li>
            <li>
                <a href="#" class="flex flex-col items-center p-2 rounded-lg text-gray-700">
                    <svg class="w-6 h-6 mb-1" fill="currentColor" viewBox="0 0 26 26" xmlns="http://www.w3.org/2000/svg">
                        <path d="M7.21474 18.7853L15.0995 15.1267L18.7581 7.24187L10.8733 10.9005L7.21474 18.7853ZM13 14.0834C12.693 14.0834 12.4357 13.9795 12.2281 13.7719C12.0205 13.5643 11.9166 13.307 11.9166 13C11.9166 12.6931 12.0205 12.4358 12.2281 12.2282C12.4357 12.0205 12.693 11.9167 13 11.9167C13.3069 11.9167 13.5642 12.0205 13.7719 12.2282C13.9795 12.4358 14.0833 12.6931 14.0833 13C14.0833 13.307 13.9795 13.5643 13.7719 13.7719C13.5642 13.9795 13.3069 14.0834 13 14.0834ZM13.0021 24.2161C11.4589 24.2161 10.0054 23.9236 8.64152 23.3387C7.27767 22.7538 6.08623 21.9518 5.06719 20.9328C4.04817 19.9138 3.24621 18.723 2.6613 17.3606C2.07639 15.9982 1.78394 14.5453 1.78394 13.0021C1.78394 11.4409 2.07639 9.97834 2.6613 8.61448C3.24621 7.25063 4.04738 6.06344 5.06481 5.05291C6.08222 4.04238 7.27253 3.24237 8.63572 2.65289C9.99892 2.06342 11.4525 1.76868 12.9966 1.76868C14.5587 1.76868 16.0223 2.06302 17.3873 2.6517C18.7524 3.24039 19.9398 4.03932 20.9496 5.0485C21.9594 6.05767 22.7588 7.24439 23.3478 8.60865C23.9368 9.97291 24.2313 11.4367 24.2313 13C24.2313 14.5446 23.9366 15.9988 23.3471 17.3625C22.7576 18.7262 21.9576 19.9169 20.9471 20.9347C19.9366 21.9524 18.7501 22.7538 17.3876 23.3387C16.0252 23.9236 14.5633 24.2161 13.0021 24.2161ZM13 22.0706C15.523 22.0706 17.6656 21.1883 19.4276 19.4237C21.1896 17.6591 22.0705 15.5179 22.0705 13C22.0705 10.477 21.1896 8.33443 19.4276 6.57245C17.6656 4.81046 15.5205 3.92947 12.9923 3.92947C10.4822 3.92947 8.3442 4.81046 6.57828 6.57245C4.81238 8.33443 3.92942 10.4795 3.92942 13.0077C3.92942 15.5178 4.81173 17.6558 6.57633 19.4217C8.34094 21.1876 10.4822 22.0706 13 22.0706Z" />
                    </svg>
                    <span class="text-xs font-normal">탐색</span>
                </a>
            </li>
            <li>
                <a href="#" class="flex flex-col items-center p-2 rounded-lg text-gray-700">
                    <svg class="w-6 h-6 mb-1" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.691h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.324 1.118l1.519 4.674c.3.921-.755 1.688-1.539 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.784.57-1.838-.197-1.539-1.118l1.519-4.674a1 1 0 00-.324-1.118L2.05 10.102c-.783-.57-.381-1.81.588-1.81h4.915a1 1 0 00.95-.691l1.519-4.674z" />
                    </svg>
                    <span class="text-xs font-normal">베스트</span>
                </a>
            </li>
            <li>
                <a href="#" class="flex flex-col items-center p-2 rounded-lg text-gray-700">
                    <svg class="w-6 h-6 mb-1" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M17 3H7a2 2 0 00-2 2v16l7-3.5 7 3.5V5a2 2 0 00-2-2z" />
                    </svg>
                    <span class="text-xs font-normal">저장됨</span>
                </a>
            </li>
            <li>
                <a href="#" class="flex flex-col items-center p-2 rounded-lg text-gray-700">
                    <svg class="w-6 h-6 mb-1" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path d="M14 2H6C4.9 2 4 2.9 4 4V20C4 21.1 4.9 22 6 22H18C19.1 22 20 21.1 20 20V8L14 2ZM18 20H6V4H13V9H18V20ZM12 11C10.34 11 9 12.34 9 14C9 15.66 10.34 17 12 17C13.66 17 15 15.66 15 14C15 12.34 13.66 11 12 11ZM12 15.5C11.17 15.5 10.5 14.83 10.5 14C10.5 13.17 11.17 12.5 12 12.5C12.83 12.5 13.5 13.17 13.5 14C13.5 14.83 12.83 15.5 12 15.5Z" />
                    </svg>
                    <span class="text-xs font-normal">퀘스트</span>
                </a>
            </li>
        </ul>
    </nav>

    <!-- Quill Rich Text Editor JS -->
    <script src="https://cdn.quilljs.com/1.3.6/quill.min.js"></script>
    <script type="module">
        // Firebase SDK imports
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Firebase configuration (using global variables provided by Canvas environment)
        const firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';

        // Initialize Firebase services
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        const authStatusContainer = document.getElementById('auth-status-container');
        const defaultNickname = "사용자"; // Default nickname if not logged in
        const authMessageDiv = document.getElementById('auth-message'); // Authentication message div
        const formMessageDiv = document.getElementById('form-message'); // Form submission message div
        const formMessageText = document.getElementById('form-message-text'); // Text inside form message

        let currentUserNickname = defaultNickname; // To store user's nickname for form submission

        // Function to update header based on auth state
        function updateHeader(user) {
            authStatusContainer.innerHTML = ''; // Clear existing content

            if (user) {
                // Logged in: Display nickname and dropdown menu
                const displayName = user.displayName || user.email || defaultNickname;
                currentUserNickname = displayName.split('@')[0]; // Use part before @ for email or full display name
                if (!currentUserNickname) { // Fallback if split results in empty string (e.g., if email is just "@example.com")
                    currentUserNickname = defaultNickname;
                }

                const loggedInHtml = `
                    <button id="nickname-btn" class="cursor-pointer text-gray-700 p-2 rounded-md hover:bg-gray-100 transition-colors duration-200 flex items-center">
                        <span class="mr-1">${currentUserNickname}</span>
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                    </button>
                    <div id="dropdown-menu" class="dropdown-menu hidden">
                        <a href="#" class="dropdown-item">프로필</a>
                        <a href="#" id="logout-btn" class="dropdown-item">로그아웃</a>
                    </div>
                `;
                authStatusContainer.insertAdjacentHTML('afterbegin', loggedInHtml);

                // Dropdown menu toggle
                const nicknameBtn = document.getElementById('nickname-btn');
                const dropdownMenu = document.getElementById('dropdown-menu');
                if (nicknameBtn && dropdownMenu) {
                    nicknameBtn.addEventListener('click', (event) => {
                        event.stopPropagation(); // Stop event propagation
                        dropdownMenu.classList.toggle('hidden');
                    });

                    // Close dropdown when clicking outside
                    document.addEventListener('click', (event) => {
                        if (!authStatusContainer.contains(event.target)) {
                            dropdownMenu.classList.add('hidden');
                        }
                    });
                }


                // Logout button functionality
                const logoutBtn = document.getElementById('logout-btn');
                if (logoutBtn) {
                    logoutBtn.addEventListener('click', async (event) => {
                        event.preventDefault();
                        try {
                            await signOut(auth);
                            console.log("로그아웃 성공!");
                        } catch (error) {
                            console.error("로그아웃 실패:", error);
                        }
                    });
                }

            } else {
                // Logged out: Display login button
                const loggedOutHtml = `
                    <a href="/SIGNIN" id="login-btn" class="cursor-pointer text-gray-700 p-2 rounded-md hover:bg-gray-100 transition-colors duration-200">
                        로그인
                    </a>
                `;
                authStatusContainer.insertAdjacentHTML('afterbegin', loggedOutHtml);
            }
        }

        // Detect Firebase auth state changes
        onAuthStateChanged(auth, (user) => {
            updateHeader(user);
        });

        // --- 태그 입력 및 관리 기능 ---
        const tagsInput = document.getElementById('discussion-tags-input');
        const tagsContainer = document.getElementById('tags-container');
        const tagsHiddenInput = document.getElementById('discussion-tags-hidden');
        let tags = []; // 태그들을 저장할 배열

        function renderTags() {
            tagsContainer.innerHTML = ''; // 기존 태그 지우기
            tags.forEach((tag, index) => {
                const tagElement = document.createElement('span');
                tagElement.className = 'inline-flex items-center px-3 py-1 rounded-full bg-blue-100 text-blue-800 text-sm font-medium';
                tagElement.innerHTML = `
                    ${tag}
                    <svg class="ml-2 -mr-0.5 h-4 w-4 text-blue-600 hover:text-blue-800 cursor-pointer" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" data-index="${index}">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                `;
                tagsContainer.appendChild(tagElement);

                // 태그 삭제 이벤트 리스너 추가
                tagElement.querySelector('svg').addEventListener('click', (e) => {
                    const removeIndex = parseInt(e.target.dataset.index);
                    tags.splice(removeIndex, 1); // 배열에서 태그 제거
                    renderTags(); // 태그 다시 렌더링
                });
            });
            tagsHiddenInput.value = tags.join(','); // 숨겨진 input에 쉼표로 구분된 태그 저장
        }

        tagsInput.addEventListener('keydown', (event) => {
            if (event.key === 'Enter') {
                event.preventDefault(); // 엔터 키로 인한 폼 제출 방지
                const tagText = tagsInput.value.trim();
                if (tagText && !tags.includes(tagText)) { // 중복 방지
                    tags.push(tagText);
                    tagsInput.value = ''; // 입력 필드 초기화
                    renderTags(); // 태그 UI 업데이트
                }
            }
        });

        // --- 배심원 토글 버튼 기능 ---
        const juryToggle = document.getElementById('jury-toggle');
        const juryStatusText = document.getElementById('jury-status');
        const juryRequiredHiddenInput = document.getElementById('jury-required-hidden');

        // 초기 상태 설정
        if (juryToggle) {
            if (juryToggle.checked) {
                juryStatusText.textContent = '필요함';
                juryRequiredHiddenInput.value = 'yes';
            } else {
                juryStatusText.textContent = '필요 없음';
                juryRequiredHiddenInput.value = 'no';
            }

            juryToggle.addEventListener('change', () => {
                if (juryToggle.checked) {
                    juryStatusText.textContent = '필요함';
                    juryRequiredHiddenInput.value = 'yes';
                } else {
                    juryStatusText.textContent = '필요 없음';
                    juryRequiredHiddenInput.value = 'no';
                }
            });
        }


        // --- 토론 형식에 따른 옵션 표시/숨김 ---
        const discussionFormatSelect = document.getElementById('discussion-format');
        const proConOptionsDiv = document.getElementById('pro-con-options');
        const debateTypeTeamRadio = document.getElementById('debate-type-team');
        const debateType1v1Radio = document.getElementById('debate-type-1v1');
        const teamMembersOptionDiv = document.getElementById('team-members-option');

        function toggleProConOptions() {
            if (discussionFormatSelect.value === '찬반 토론') {
                proConOptionsDiv.classList.remove('hidden');
                // 찬반 토론 선택 시 토론 유형의 기본값에 따라 팀당 인원 표시/숨김
                toggleTeamMembersOption();
            } else {
                proConOptionsDiv.classList.add('hidden');
            }
        }

        function toggleTeamMembersOption() {
            if (debateTypeTeamRadio.checked) {
                teamMembersOptionDiv.classList.remove('hidden');
            } else {
                teamMembersOptionDiv.classList.add('hidden');
            }
        }

        // 초기 로드 시 설정
        if (discussionFormatSelect) {
            toggleProConOptions();
            // 토론 형식 드롭다운 변경 시
            discussionFormatSelect.addEventListener('change', toggleProConOptions);
        }


        // 토론 유형 (팀 토론/1 vs 1 토론) 라디오 버튼 변경 시
        if (debateTypeTeamRadio) debateTypeTeamRadio.addEventListener('change', toggleTeamMembersOption);
        if (debateType1v1Radio) debateType1v1Radio.addEventListener('change', toggleTeamMembersOption);


        // --- Quill 에디터 초기화 ---
        // 내용 에디터 설정
        const contentToolbarOptions = [
            ['bold', 'italic', 'underline', 'strike'],        // 텍스트 스타일
            ['blockquote', 'code-block'],                     // 블록 인용, 코드 블록

            [{ 'header': 1 }, { 'header': 2 }],               // 제목 크기
            [{ 'list': 'ordered'}, { 'list': 'bullet' }],     // 순서 목록, 불릿 목록
            [{ 'script': 'sub'}, { 'script': 'super' }],      // 아래첨자, 위첨자
            [{ 'indent': '-1'}, { 'indent': '+1' }],          // 들여쓰기 감소/증가
            [{ 'direction': 'rtl' }],                         // 텍스트 방향

            [{ 'size': ['small', false, 'large', 'huge'] }],  // 글자 크기
            [{ 'header': [1, 2, 3, 4, 5, 6, false] }],        // 헤더

            [{ 'color': [] }, { 'background': [] }],          // 텍스트 색상, 배경 색상
            [{ 'font': [] }],                                 // 폰트
            [{ 'align': [] }],                                // 텍스트 정렬

            ['link', 'image', 'video'],                       // 링크, 이미지, 비디오
            ['clean']                                         // 포맷 지우기
        ];

        const contentQuill = new Quill('#discussion-content-editor', {
            modules: {
                toolbar: contentToolbarOptions
            },
            theme: 'snow' // 'snow' 또는 'bubble' 테마
        });

        // 썸네일 이미지 에디터 설정 (이미지 업로드 기능만)
        const thumbnailToolbarOptions = [
            ['image'] // 이미지 업로드 버튼만 포함
        ];

        const thumbnailQuill = new Quill('#thumbnail-image-editor', {
            modules: {
                toolbar: thumbnailToolbarOptions
            },
            theme: 'snow'
        });

        // Function to show form messages
        function showFormMessage(message, type = 'success') {
            formMessageText.textContent = message;
            formMessageDiv.classList.remove('hidden', 'bg-green-100', 'bg-red-100', 'border-green-400', 'border-red-400', 'text-green-700', 'text-red-700');

            if (type === 'success') {
                formMessageDiv.classList.add('bg-green-100', 'border-green-400', 'text-green-700');
            } else if (type === 'error') {
                formMessageDiv.classList.add('bg-red-100', 'border-red-400', 'text-red-700');
            }
            formMessageDiv.classList.remove('hidden');

            // Hide message after 5 seconds
            setTimeout(() => {
                formMessageDiv.classList.add('hidden');
            }, 5000);
        }

        // --- 폼 제출 처리 ---
        const createDiscussionForm = document.getElementById('create-discussion-form');
        if (createDiscussionForm) {
            createDiscussionForm.addEventListener('submit', async (event) => {
                event.preventDefault(); // 기본 폼 제출 방지

                // Check if user is logged in
                if (!auth.currentUser) {
                    authMessageDiv.classList.remove('hidden');
                    // Hide message after 5 seconds
                    setTimeout(() => {
                        authMessageDiv.classList.add('hidden');
                    }, 5000);
                    return; // Stop form submission
                } else {
                    authMessageDiv.classList.add('hidden'); // Hide message if user is logged in
                }

                // Quill 에디터의 내용을 hidden input에 저장
                document.getElementById('discussion-content-hidden').value = contentQuill.root.innerHTML;
                // 썸네일 이미지 에디터의 내용을 hidden input에 저장 (주로 첫 번째 이미지 태그의 src를 추출)
                const thumbnailContent = thumbnailQuill.root.innerHTML;
                const imgMatch = thumbnailContent.match(/<img[^>]+src="([^">]+)"/);
                document.getElementById('thumbnail-image-hidden').value = imgMatch ? imgMatch[1] : '';

                const title = document.getElementById('discussion-title').value;
                const category = document.getElementById('discussion-category').value;
                const format = document.getElementById('discussion-format').value;
                const content = document.getElementById('discussion-content-hidden').value; // Quill 에디터 내용
                const thumbnailImage = document.getElementById('thumbnail-image-hidden').value; // 썸네일 이미지
                const submittedTags = tagsHiddenInput.value.split(',').filter(tag => tag.trim() !== ''); // Filter empty tags
                const submittedJuryRequired = juryRequiredHiddenInput.value;

                let debateType = null;
                let teamMembers = null;
                const timeSettings = {};

                if (format === '찬반 토론') {
                    debateType = document.querySelector('input[name="debate_type"]:checked')?.value || null;
                    if (debateType === 'team') {
                        teamMembers = parseInt(document.getElementById('team-members')?.value) || 0;
                    }

                    timeSettings.proposition = parseInt(document.getElementById('time-proposition')?.value) || 0;
                    timeSettings.opening = parseInt(document.getElementById('time-opening')?.value) || 0;
                    timeSettings.rebuttal = parseInt(document.getElementById('time-rebuttal')?.value) || 0;
                    timeSettings.final = parseInt(document.getElementById('time-final')?.value) || 0;
                    timeSettings.juryJudgment = parseInt(document.getElementById('time-jury-judgment')?.value) || 0;
                }

                const userId = auth.currentUser.uid;
                const discussionCollectionPath = `artifacts/${appId}/users/${userId}/discussions`;

                const discussionData = {
                    title: title,
                    category: category,
                    format: format,
                    content: content,
                    thumbnailImage: thumbnailImage,
                    tags: submittedTags,
                    juryRequired: submittedJuryRequired === 'yes',
                    createdAt: new Date(),
                    authorId: userId,
                    authorNickname: currentUserNickname,
                    // Pro/Con debate specific fields if applicable
                    debate: format === '찬반 토론' ? {
                        type: debateType,
                        teamMembers: teamMembers,
                        timeSettings: timeSettings
                    } : null,
                };

                try {
                    const docRef = await addDoc(collection(db, discussionCollectionPath), discussionData);
                    console.log("Document written with ID: ", docRef.id);
                    showFormMessage("토론이 성공적으로 생성되었습니다!", "success");
                    createDiscussionForm.reset(); // Optionally reset form after success
                    contentQuill.setContents([]); // Clear Quill content
                    thumbnailQuill.setContents([]); // Clear thumbnail Quill content
                    tags = []; // Clear tags array
                    renderTags(); // Update tags UI
                } catch (e) {
                    console.error("Error adding document: ", e);
                    showFormMessage(`토론 생성에 실패했습니다: ${e.message}`, "error");
                }
            });
        }
    </script>
</body>
</html>
