<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>디리토 웹사이트 뼈대</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        @font-face {
            font-family: 'Pretendard-Regular';
            src: url('https://fastly.jsdelivr.net/gh/Project-Noonnu/noonfonts_2107@1.1/Pretendard-Regular.woff') format('woff');
            font-weight: 400;
            font-style: normal;
        }
        body {
            font-family: 'Pretendard-Regular', 'Inter', sans-serif; /* Pretendard 폰트 적용 */
            background-color: #f0f2f5; /* 밝은 회색 배경 */
        }
        /* 고정 헤더를 위한 스타일 */
        .fixed-header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 64px; /* 헤더 높이 고정 */
            z-index: 1000; /* 다른 요소 위에 오도록 설정 */
        }
        /* 고정 사이드바를 위한 스타일 */
        .fixed-sidebar {
            position: fixed;
            top: 64px; /* 헤더 높이만큼 아래로 시작 */
            left: 0;
            bottom: 0;
            width: 16rem; /* w-64 (256px)와 동일 */
            background-color: #ffffff;
            border-right: 1px solid #d1d5db;
            z-index: 999; /* 헤더보다 약간 아래 */
            display: none; /* 모바일에서는 기본 숨김 */
            flex-direction: column;
            justify-content: space-between;
            padding: 1.5rem; /* p-6과 동일 */
        }
        /* 대형 화면 (lg)에서 사이드바 표시 */
        @media (min-width: 1024px) {
            .fixed-sidebar {
                display: flex;
            }
        }

        /* 메인 콘텐츠 영역이 헤더와 사이드바/하단 내비게이션 바를 피하도록 조정 */
        .main-content-area {
            margin-top: 64px; /* 헤더 높이만큼 위쪽 마진 */
            flex: 1;
            overflow-y: auto;
            background-color: #ffffff;
            padding-left: 0; /* 모바일에서 좌우 패딩을 0으로 완전히 제거 */
            padding-right: 0; /* 모바일에서 좌우 패딩을 0으로 완전히 제거 */
            margin-left: 0; /* 모바일에서는 왼쪽 마진 없음 */
            padding-bottom: 4rem; /* 하단 내비게이션 바 높이에 맞춰 패딩 조정 */
        }
        /* 대형 화면 (lg)에서 메인 콘텐츠 영역 왼쪽 마진 조정 */
        @media (min-width: 1024px) {
            .main-content-area {
                margin-left: 16rem; /* 사이드바 너비만큼 왼쪽 마진 */
                padding: 2rem; /* 데스크톱에서는 패딩을 2rem (32px)으로 유지 */
                padding-bottom: 2rem; /* 데스크톱에서는 하단 패딩 줄임 */
            }
        }

        /* 캐러셀 아이템이 줄바꿈되지 않도록 */
        .carousel-item {
            flex: 0 0 auto; /* 아이템이 축소되거나 확장되지 않도록 고정 */
            width: 140px; /* 모바일: 아이템 너비 고정 */
            margin-right: 16px; /* 아이템 간 간격 */
        }
        .carousel-item:last-child {
            margin-right: 0; /* 마지막 아이템에는 마진 없음 */
        }
        .carousel-item img {
            width: 140px; /* 모바일: 이미지 너비 고정 */
            height: 180px; /* 모바일: 이미지 높이 고정 */
            object-fit: cover;
            border-radius: 0.375rem; /* rounded-md */
            margin-bottom: 0.5rem; /* mb-2 */
            margin-left: auto;
            margin-right: auto;
        }

        /* PC (lg) 화면에서 캐러셀 아이템 크기 */
        @media (min-width: 1024px) {
            .carousel-item {
                width: 160px; /* PC: 아이템 너비 원래대로 */
            }
            .carousel-item img {
                width: 160px; /* PC: 이미지 너비 원래대로 */
                height: 224px; /* PC: 이미지 높이 원래대로 */
            }
        }

        /* 캐러셀 버튼 위치 및 크기 조정 */
        .carousel-nav-button {
            position: absolute;
            top: 90px; /* 모바일: 이미지 높이(180px)의 절반 */
            transform: translateY(-50%); /* 정확한 중앙 정렬을 위해 버튼 자체 높이의 절반만큼 위로 이동 */
            background-color: #ffffff; /* 불투명 흰색 배경 */
            border: 1px solid #d1d5db; /* 회색 테두리 */
            border-radius: 9999px; /* 완전한 원형 */
            padding: 0.625rem; /* 10px */
            cursor: pointer;
            transition: background-color 0.2s ease-in-out, opacity 0.3s ease-in-out; /* 불투명도 전환 추가 */
            width: 48px; /* 32px(svg) + 8px(padding) * 2 = 48px */
            height: 48px; /* 동일하게 설정 */
            display: none; /* 모바일에서는 기본 숨김 */
            align-items: center;
            justify-content: center;
            pointer-events: auto; /* 기본적으로 클릭 가능 */
        }
        /* 대형 화면 (lg)에서 캐러셀 버튼 표시 및 위치 조정 */
        @media (min-width: 1024px) {
            .carousel-nav-button {
                display: flex;
                top: 112px; /* PC: 이미지 높이(224px)의 절반 */
            }
        }

        .carousel-nav-button.left-2 {
            left: -24px; /* 버튼 너비(48px)의 절반만큼 왼쪽으로 이동 */
        }
        .carousel-nav-button.right-2 {
            right: -24px; /* 버튼 너비(48px)의 절반만큼 오른쪽으로 이동 */
        }
        .carousel-nav-button:hover {
            background-color: #f3f4f6; /* hover 시 약간 어둡게 */
        }
        .carousel-nav-button svg {
            width: 1.75rem; /* 28px */
            height: 1.75rem; /* 동일하게 설정 */
            color: #4b5563; /* text-gray-600과 동일 */
        }
        /* 스크롤 불가능 시 버튼 숨김 */
        .carousel-nav-button.hidden-button {
            opacity: 0;
            pointer-events: none; /* 클릭 불가능하게 */
        }
        /* 선택된 사이드바 항목 스타일 */
        .selected-nav-item {
            color: #2563eb; /* text-blue-600 */
            background-color: #eff6ff; /* bg-blue-50 */
        }
        /* 선택된 항목의 호버 효과는 없애거나 다르게 설정 (선택된 상태 유지) */
        .selected-nav-item:hover {
            background-color: #eff6ff; /* 선택된 상태의 배경색 유지 */
            color: #2563eb; /* 선택된 상태의 텍스트 색상 유지 */
        }

        /* 캐러셀 스크롤바 숨기기 */
        .flex.overflow-x-scroll::-webkit-scrollbar {
            display: none; /* Webkit (Chrome, Safari) */
        }

        .flex.overflow-x-scroll {
            -ms-overflow-style: none;  /* IE and Edge */
            scrollbar-width: none;  /* Firefox */
        }

        /* 사이드바 항목 호버 효과 제거 */
        .sidebar-nav-item:hover {
            background-color: transparent; /* 호버 시 배경색 변경 없음 */
            color: inherit; /* 호버 시 텍스트 색상 변경 없음 */
        }

        /* 로그인 텍스트 링크 스타일 */
        #login-btn {
            color: #4b5563; /* 기본 텍스트 색상 */
            padding: 0.5rem 1rem; /* 상하 0.5rem, 좌우 1rem 패딩 */
            border-radius: 0.375rem; /* rounded-md */
            font-weight: 500; /* font-medium */
            transition: background-color 0.2s ease-in-out, color 0.2s ease-in-out; /* 부드러운 전환 효과 */
        }

        #login-btn:hover {
            background-color: #f3f4f6; /* 호버 시 투명한 배경처럼 보이는 밝은 회색 */
            color: #1f2937; /* 호버 시 텍스트 색상 약간 진하게 */
        }

        /* 드롭다운 메뉴 스타일 */
        .dropdown-menu {
            position: absolute;
            top: 100%; /* 헤더 바로 아래 */
            right: 0;
            background-color: white;
            border: 1px solid #d1d5db;
            border-radius: 0.375rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            min-width: 160px;
            z-index: 1001; /* 헤더보다 위에 */
            padding: 0.5rem 0;
        }

        .dropdown-menu a {
            display: block;
            padding: 0.75rem 1rem;
            color: #374151;
            font-weight: 500;
            transition: background-color 0.2s ease-in-out;
        }

        .dropdown-menu a:hover {
            background-color: #f3f4f6;
        }
    </style>
</head>
<body class="flex min-h-screen flex-col">

    <header class="fixed-header flex items-center justify-between bg-white p-4 border-b border-gray-300">
        <div class="flex items-center">
            <!-- 로고 이미지를 헤더 높이에 적절히 맞추고 너비는 비율에 따라 자동 조절 -->
            <img src="/image/logo.png" alt="UNIZ 로고" class="h-10 w-auto max-w-full">
        </div>
        <div class="flex items-center space-x-4 relative">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-6 h-6 text-gray-600 cursor-pointer hover:text-blue-500 transition-colors duration-200">
                <path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z" />
            </svg>
            <!-- 로그인 상태에 따라 조건부 렌더링될 요소 -->
            <div id="auth-status-container" class="relative">
                <!-- 여기에 로그인 버튼 또는 닉네임/드롭다운이 들어갑니다. -->
            </div>
        </div>
    </header>

    <div class="flex flex-1">
        <aside class="fixed-sidebar">
            <div>
                <nav>
                    <ul>
                        <li class="mb-2">
                            <a href="#" class="flex items-center p-3 rounded-lg transition-colors duration-200 selected-nav-item">
                                <svg class="w-6 h-6 mr-3" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M4 23V9.66667L13 3L22 9.66667V23H14.125V16.3333H11.875V23H4Z" />
                                </svg>
                                <span class="font-normal">홈</span>
                            </a>
                        </li>
                        <li class="mb-2">
                            <a href="#" class="flex items-center text-gray-700 p-3 rounded-lg transition-colors duration-200 sidebar-nav-item">
                                <svg class="w-6 h-6 mr-3" fill="currentColor" viewBox="0 0 26 26" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M7.21474 18.7853L15.0995 15.1267L18.7581 7.24187L10.8733 10.9005L7.21474 18.7853ZM13 14.0834C12.693 14.0834 12.4357 13.9795 12.2281 13.7719C12.0205 13.5643 11.9166 13.307 11.9166 13C11.9166 12.6931 12.0205 12.4358 12.2281 12.2282C12.4357 12.0205 12.693 11.9167 13 11.9167C13.3069 11.9167 13.5642 12.0205 13.7719 12.2282C13.9795 12.4358 14.0833 12.6931 14.0833 13C14.0833 13.307 13.9795 13.5643 13.7719 13.7719C13.5642 13.9795 13.3069 14.0834 13 14.0834ZM13.0021 24.2161C11.4589 24.2161 10.0054 23.9236 8.64152 23.3387C7.27767 22.7538 6.08623 21.9518 5.06719 20.9328C4.04817 19.9138 3.24621 18.723 2.6613 17.3606C2.07639 15.9982 1.78394 14.5453 1.78394 13.0021C1.78394 11.4409 2.07639 9.97834 2.6613 8.61448C3.24621 7.25063 4.04738 6.06344 5.06481 5.05291C6.08222 4.04238 7.27253 3.24237 8.63572 2.65289C9.99892 2.06342 11.4525 1.76868 12.9966 1.76868C14.5587 1.76868 16.0223 2.06302 17.3873 2.6517C18.7524 3.24039 19.9398 4.03932 20.9496 5.0485C21.9594 6.05767 22.7588 7.24439 23.3478 8.60865C23.9368 9.97291 24.2313 11.4367 24.2313 13C24.2313 14.5446 23.9366 15.9988 23.3471 17.3625C22.7576 18.7262 21.9576 19.9169 20.9471 20.9347C19.9366 21.9524 18.7501 22.7538 17.3876 23.3387C16.0252 23.9236 14.5633 24.2161 13.0021 24.2161ZM13 22.0706C15.523 22.0706 17.6656 21.1883 19.4276 19.4237C21.1896 17.6591 22.0705 15.5179 22.0705 13C22.0705 10.477 21.1896 8.33443 19.4276 6.57245C17.6656 4.81046 15.5205 3.92947 12.9923 3.92947C10.4822 3.92947 8.3442 4.81046 6.57828 6.57245C4.81238 8.33443 3.92942 10.4795 3.92942 13.0077C3.92942 15.5178 4.81173 17.6558 6.57633 19.4217C8.34094 21.1876 10.4822 22.0706 13 22.0706Z" />
                                </svg>
                                <span class="font-normal">탐색</span>
                            </a>
                        </li>
                        <li class="mb-2">
                            <a href="#" class="flex items-center text-gray-700 p-3 rounded-lg transition-colors duration-200 sidebar-nav-item">
                                <svg class="w-6 h-6 mr-3" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.691h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.324 1.118l1.519 4.674c.3.921-.755 1.688-1.539 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.784.57-1.838-.197-1.539-1.118l1.519-4.674a1 1 0 00-.324-1.118L2.05 10.102c-.783-.57-.381-1.81.588-1.81h4.915a1 1 0 00.95-.691l1.519-4.674z" />
                                </svg>
                                <span class="font-normal">베스트</span>
                            </a>
                        </li>
                        <li class="mb-2">
                            <a href="#" class="flex items-center text-gray-700 p-3 rounded-lg transition-colors duration-200 sidebar-nav-item">
                                <svg class="w-6 h-6 mr-3" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M17 3H7a2 2 0 00-2 2v16l7-3.5 7 3.5V5a2 2 0 00-2-2z" />
                                </svg>
                                <span class="font-normal">저장됨</span>
                            </a>
                        </li>
                        <li class="mb-2">
                            <a href="#" class="flex items-center text-gray-700 p-3 rounded-lg transition-colors duration-200 sidebar-nav-item">
                                <svg class="w-6 h-6 mr-3" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M14 2H6C4.9 2 4 2.9 4 4V20C4 21.1 4.9 22 6 22H18C19.1 22 20 21.1 20 20V8L14 2ZM18 20H6V4H13V9H18V20ZM12 11C10.34 11 9 12.34 9 14C9 15.66 10.34 17 12 17C13.66 17 15 15.66 15 14C15 12.34 13.66 11 12 11ZM12 15.5C11.17 15.5 10.5 14.83 10.5 = 14C10.5 13.17 11.17 12.5 12 12.5C12.83 12.5 13.5 13.17 13.5 14C13.5 14.83 12.83 15.5 12 15.5Z" />
                                </svg>
                                <span class="font-normal">퀘스트</span>
                            </a>
                        </li>
                    </ul>
                </nav>
            </div>
            <div>
            </div>
        </aside>

        <main class="main-content-area">
            <section class="mb-8 pt-6">
                <div class="px-4 flex justify-between items-center mb-6">
                    <h2 class="text-xl font-semibold text-gray-800">따끈따끈 신작이 왔어요 (*´▽`*)ﾉ</h2>
                    <a href="#" class="text-gray-600 hover:text-gray-800 font-normal">더보기</a>
                </div>
                <div class="relative">
                    <div id="new-releases-carousel" class="flex overflow-x-scroll scroll-smooth pb-4 px-4">
                        <!-- Discussions will be dynamically loaded here -->
                    </div>
                    <button id="new-releases-carousel-prev" class="carousel-nav-button left-2">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
                    </button>
                    <button id="new-releases-carousel-next" class="carousel-nav-button right-2">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
                    </button>
                </div>
            </section>

            <section class="mb-8 pt-6">
                <div class="px-4 flex justify-between items-center mb-6">
                    <h2 class="text-xl font-semibold text-gray-800">지난주 독자들의 ♥ 가 듬뿍!</h2>
                    <a href="#" class="text-gray-600 hover:text-gray-800 font-normal">더보기</a>
                </div>
                <div class="relative">
                    <div id="popular-carousel" class="flex overflow-x-scroll scroll-smooth pb-4 px-4">
                        <!-- Discussions will be dynamically loaded here -->
                    </div>
                    <button id="popular-carousel-prev" class="carousel-nav-button left-2">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
                    </button>
                    <button id="popular-carousel-next" class="carousel-nav-button right-2">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
                    </button>
                </div>
            </section>

            <section class="mb-8 pt-6">
                <div class="px-4 flex justify-between items-center mb-6">
                    <h2 class="text-xl font-semibold text-gray-800">실시간 인기 주제</h2>
                    <a href="#" class="text-gray-600 hover:text-gray-800 font-normal">더보기</a>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 px-4" id="popular-topics-grid">
                    <!-- Dynamic popular topics here or keep static for now -->
                     <div class="bg-white p-4 rounded-lg shadow-sm border border-gray-200 flex items-center">
                        <span class="text-lg font-bold text-blue-600 mr-3">1</span>
                        <div>
                            <h3 class="font-medium text-gray-900 text-base"># 로맨스 판타지</h3>
                            <p class="text-sm text-gray-600 font-normal">지금 가장 뜨거운 장르!</p>
                        </div>
                    </div>
                    <div class="bg-white p-4 rounded-lg shadow-sm border border-gray-200 flex items-center">
                        <span class="text-lg font-bold text-blue-600 mr-3">2</span>
                        <div>
                            <h3 class="font-medium text-gray-900 text-base"># 현대 로맨스</h3>
                            <p class="text-sm text-gray-600 font-normal">현실 공감 100%</p>
                        </div>
                    </div>
                    <div class="bg-white p-4 rounded-lg shadow-sm border border-gray-200 flex items-center">
                        <span class="text-lg font-bold text-blue-600 mr-3">3</span>
                        <div>
                            <h3 class="font-medium text-gray-900 text-base"># BL (Boys Love)</h3>
                            <p class="text-sm text-gray-600 font-normal">매니아층 열광!</p>
                        </div>
                    </div>
                    <div class="bg-white p-4 rounded-lg shadow-sm border border-gray-200 flex items-center">
                        <span class="text-lg font-bold text-blue-600 mr-3">4</span>
                        <div>
                            <h3 class="font-medium text-gray-900 text-base"># 스릴러/미스터리</h3>
                            <p class="text-sm text-gray-600 font-normal">손에 땀을 쥐는 전개</p>
                        </div>
                    </div>
                    <div class="bg-white p-4 rounded-lg shadow-sm border border-gray-200 flex items-center">
                        <span class="text-lg font-bold text-blue-600 mr-3">5</span>
                        <div>
                            <h3 class="font-medium text-gray-900 text-base"># 판타지 모험</h3>
                            <p class="text-sm text-gray-600 font-normal">새로운 세계로 떠나요</p>
                        </div>
                    </div>
                    <div class="bg-white p-4 rounded-lg shadow-sm border border-gray-200 flex items-center">
                        <span class="text-lg font-bold text-blue-600 mr-3">6</span>
                        <div>
                            <h3 class="font-medium text-gray-900 text-base"># 무협</h3>
                            <p class="text-sm text-gray-600 font-normal">강호의 세계</p>
                        </div>
                    </div>
                </div>
            </section>

            <section class="mb-8 pt-6">
                <div class="px-4 flex justify-between items-center mb-6">
                    <h2 class="text-xl font-semibold text-gray-800">새롭게 떠오르는 작품</h2>
                    <a href="#" class="text-gray-600 hover:text-gray-800 font-normal">더보기</a>
                </div>
                <div class="relative">
                    <div id="rising-stars-carousel" class="flex overflow-x-scroll scroll-smooth pb-4 px-4">
                        <!-- Discussions will be dynamically loaded here -->
                    </div>
                    <button id="rising-stars-carousel-prev" class="carousel-nav-button left-2">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
                    </button>
                    <button id="rising-stars-carousel-next" class="carousel-nav-button right-2">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
                    </button>
                </div>
            </section>

            <section class="mb-8 pt-6">
                <div class="px-4 flex justify-between items-center mb-6">
                    <h2 class="text-xl font-semibold text-gray-800">에디터의 추천작</h2>
                    <a href="#" class="text-gray-600 hover:text-gray-800 font-normal">더보기</a>
                </div>
                <div class="relative">
                    <div id="editors-pick-carousel" class="flex overflow-x-scroll scroll-smooth pb-4 px-4">
                        <!-- Discussions will be dynamically loaded here -->
                    </div>
                    <button id="editors-pick-carousel-prev" class="carousel-nav-button left-2">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
                    </button>
                    <button id="editors-pick-carousel-next" class="carousel-nav-button right-2">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
                    </button>
                </div>
            </section>
        </main>
    </div>

    <nav class="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-300 py-0.5 px-2 shadow-lg lg:hidden z-1000">
        <ul class="flex justify-around items-center h-full">
            <li>
                <a href="#" class="flex flex-col items-center p-2 rounded-lg text-blue-600">
                    <svg class="w-6 h-6 mb-1" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path d="M4 23V9.66667L13 3L22 9.66667V23H14.125V16.3333H11.875V23H4Z" />
                    </svg>
                    <span class="text-xs font-normal">홈</span>
                </a>
            </li>
            <li>
                <a href="#" class="flex flex-col items-center p-2 rounded-lg text-gray-700">
                    <svg class="w-6 h-6 mb-1" fill="currentColor" viewBox="0 0 26 26" xmlns="http://www.w3.org/2000/svg">
                        <path d="M7.21474 18.7853L15.0995 15.1267L18.7581 7.24187L10.8733 10.9005L7.21474 18.7853ZM13 14.0834C12.693 14.0834 12.4357 13.9795 12.2281 13.7719C12.0205 13.5643 11.9166 13.307 11.9166 13C11.9166 12.6931 12.0205 12.4358 12.2281 12.2282C12.4357 12.0205 12.693 11.9167 13 11.9167C13.3069 11.9167 13.5642 12.0205 13.7719 12.2282C13.9795 12.4358 14.0833 12.6931 14.0833 13C14.0833 13.307 13.9795 13.5643 13.7719 13.7719C13.5642 13.9795 13.3069 14.0834 13 14.0834ZM13.0021 24.2161C11.4589 24.2161 10.0054 23.9236 8.64152 23.3387C7.27767 22.7538 6.08623 21.9518 5.06719 20.9328C4.04817 19.9138 3.24621 18.723 2.6613 17.3606C2.07639 15.9982 1.78394 14.5453 1.78394 13.0021C1.78394 11.4409 2.07639 9.97834 2.6613 8.61448C3.24621 7.25063 4.04738 6.06344 5.06481 5.05291C6.08222 4.04238 7.27253 3.24237 8.63572 2.65289C9.99892 2.06342 11.4525 1.76868 12.9966 1.76868C14.5587 1.76868 16.0223 2.06302 17.3873 2.6517C18.7524 3.24039 19.9398 4.03932 20.9496 5.0485C21.9594 6.05767 22.7588 7.24439 23.3478 8.60865C23.9368 9.97291 24.2313 11.4367 24.2313 13C24.2313 14.5446 23.9366 15.9988 23.3471 17.3625C22.7576 18.7262 21.9576 19.9169 20.9471 20.9347C19.9366 21.9524 18.7501 22.7538 17.3876 23.3387C16.0252 23.9236 14.5633 24.2161 13.0021 24.2161ZM13 22.0706C15.523 22.0706 17.6656 21.1883 19.4276 19.4237C21.1896 17.6591 22.0705 15.5179 22.0705 13C22.0705 10.477 21.1896 8.33443 19.4276 6.57245C17.6656 4.81046 15.5205 3.92947 12.9923 3.92947C10.4822 3.92947 8.3442 4.81046 6.57828 6.57245C4.81238 8.33443 3.92942 10.4795 3.92942 13.0077C3.92942 15.5178 4.81173 17.6558 6.57633 19.4217C8.34094 21.1876 10.4822 22.0706 13 22.0706Z" />
                    </svg>
                    <span class="text-xs font-normal">탐색</span>
                </a>
            </li>
            <li>
                <a href="#" class="flex flex-col items-center p-2 rounded-lg text-gray-700">
                    <svg class="w-6 h-6 mb-1" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.691h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.324 1.118l1.519 4.674c.3.921-.755 1.688-1.539 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.784.57-1.838-.197-1.539-1.118l1.519-4.674a1 1 0 00-.324-1.118L2.05 10.102c-.783-.57-.381-1.81.588-1.81h4.915a1 1 0 00.95-.691l1.519-4.674z" />
                    </svg>
                    <span class="text-xs font-normal">베스트</span>
                </a>
            </li>
            <li>
                <a href="#" class="flex flex-col items-center p-2 rounded-lg text-gray-700">
                    <svg class="w-6 h-6 mb-1" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M17 3H7a2 2 0 00-2 2v16l7-3.5 7 3.5V5a2 2 0 00-2-2z" />
                    </svg>
                    <span class="text-xs font-normal">저장됨</span>
                </a>
            </li>
            <li>
                <a href="#" class="flex flex-col items-center p-2 rounded-lg text-gray-700">
                    <svg class="w-6 h-6 mb-1" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path d="M14 2H6C4.9 2 4 2.9 4 4V20C4 21.1 4.9 22 6 22H18C19.1 22 20 21.1 20 20V8L14 2ZM18 20H6V4H13V9H18V20ZM12 11C10.34 11 9 12.34 9 14C9 15.66 10.34 17 12 17C13.66 17 15 15.66 15 14C15 12.34 13.66 11 12 11ZM12 15.5C11.17 15.5 10.5 14.83 10.5 = 14C10.5 13.17 11.17 12.5 12 12.5C12.83 12.5 13.5 13.17 13.5 14C13.5 14.83 12.83 15.5 12 15.5Z" />
                    </svg>
                    <span class="text-xs font-normal">퀘스트</span>
                </a>
            </li>
        </ul>
    </nav>

    <script type="module">
        // Firebase SDK imports
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, onAuthStateChanged, signOut, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, onSnapshot, query, orderBy, limit } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";


        // Firebase configuration (사용자가 제공한 실제 Firebase config로 교체됨)
        const firebaseConfig = {
            apiKey: "AIzaSyDLzrMR2QVK4rWNDIg4bQv4rlYTkchnU58",
            authDomain: "uniz-a.firebaseapp.com",
            projectId: "uniz-a",
            storageBucket: "uniz-a.firebasestorage.app",
            messagingSenderId: "389183402425",
            appId: "1:389183402425:web:1272bcca61cdf9720c0668",
            measurementId: "G-RTWDXH8GKQ"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        const authStatusContainer = document.getElementById('auth-status-container');
        const defaultNickname = "사용자"; // 로그인하지 않은 경우의 닉네임
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';


        // Function to update header based on auth state
        function updateHeader(user) {
            authStatusContainer.innerHTML = ''; // 기존 내용 지우기

            if (user) {
                // 로그인 상태: 닉네임과 드롭다운 메뉴 표시
                const displayName = user.displayName || user.email || defaultNickname;
                const userNickname = displayName.split('@')[0]; // 이메일에서 @ 앞부분만 사용

                const loggedInHtml = `
                    <button id="nickname-btn" class="cursor-pointer text-gray-700 p-2 rounded-md hover:bg-gray-100 transition-colors duration-200 flex items-center">
                        <span class="mr-1">${userNickname}</span>
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                    </button>
                    <div id="dropdown-menu" class="dropdown-menu hidden">
                        <a href="#" class="dropdown-item">프로필</a>
                        <a href="#" id="logout-btn" class="dropdown-item">로그아웃</a>
                    </div>
                `;
                authStatusContainer.insertAdjacentHTML('afterbegin', loggedInHtml);

                // 드롭다운 메뉴 토글 기능
                const nicknameBtn = document.getElementById('nickname-btn');
                const dropdownMenu = document.getElementById('dropdown-menu');
                nicknameBtn.addEventListener('click', (event) => {
                    event.stopPropagation(); // 버튼 클릭 시 이벤트 전파 중지
                    dropdownMenu.classList.toggle('hidden');
                });

                // 외부 클릭 시 드롭다운 닫기
                document.addEventListener('click', (event) => {
                    // 클릭된 요소가 드롭다운 컨테이너 내부에 없는 경우 드롭다운 숨김
                    if (!authStatusContainer.contains(event.target)) {
                        dropdownMenu.classList.add('hidden');
                    }
                });

                // 로그아웃 버튼 기능
                const logoutBtn = document.getElementById('logout-btn');
                logoutBtn.addEventListener('click', async (event) => {
                    event.preventDefault();
                    try {
                        await signOut(auth);
                        console.log("로그아웃 성공!");
                    } catch (error) {
                        console.error("로그아웃 실패:", error);
                    }
                });

            } else {
                // 로그아웃 상태: 로그인 버튼 표시
                const loggedOutHtml = `
                    <a href="/SINGIN" id="login-btn" class="cursor-pointer text-gray-700 p-2 rounded-md hover:bg-gray-100 transition-colors duration-200">
                        로그인
                    </a>
                `;
                authStatusContainer.insertAdjacentHTML('afterbegin', loggedOutHtml);
            }
        }

        // Firebase Auth initialization and handling
        let authReadyPromise = Promise.resolve(); // 초기화는 완료된 Promise로 시작

        if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
            // __initial_auth_token이 있으면 커스텀 토큰으로 로그인 시도
            authReadyPromise = signInWithCustomToken(auth, __initial_auth_token)
                .then(() => console.log("Signed in with custom token."))
                .catch((error) => {
                    console.error("Custom token sign-in failed:", error);
                    // 익명 로그인으로 폴백하지 않음.
                    // onAuthStateChanged가 null 사용자를 처리하도록 둠.
                });
        }
        // __initial_auth_token이 정의되지 않은 경우, 여기서 로그인 시도는 없음.
        // onAuthStateChanged가 null 사용자로 트리거될 것임.

        // Firebase 인증 상태 변경 감지
        onAuthStateChanged(auth, (user) => {
            updateHeader(user);
        });

        // authReadyPromise를 사용하여 Firestore 작업이 인증 준비 후에 실행되도록 함
        // (public 데이터 읽기는 인증이 필수는 아니지만, 일관성을 위해)
        authReadyPromise.then(() => {
            // 로그인 상태와 관계없이 공개 토론 목록을 로드
            carousels.forEach(carousel => {
                setupCarouselNavigation(carousel.id, carousel.prev, carousel.next);
                fetchAndRenderDiscussions(carousel.id, carousel.sortBy, carousel.limit);
            });
        }).catch(error => {
            console.error("Authentication setup failed, discussions might not load correctly if auth was required for other parts:", error);
            // 인증 설정 실패 시에도 공개 토론 로드를 시도
            carousels.forEach(carousel => {
                setupCarouselNavigation(carousel.id, carousel.prev, carousel.next);
                fetchAndRenderDiscussions(carousel.id, carousel.sortBy, carousel.limit);
            });
        });


        // 캐러셀 기능
        const carousels = [{
            id: 'new-releases-carousel',
            prev: 'new-releases-carousel-prev',
            next: 'new-releases-carousel-next',
            sortBy: 'createdAt',
            limit: 10
        }, {
            id: 'popular-carousel',
            prev: 'popular-carousel-prev',
            next: 'popular-carousel-next',
            sortBy: 'likes',
            limit: 10
        }, {
            id: 'rising-stars-carousel',
            prev: 'rising-stars-carousel-prev',
            next: 'rising-stars-carousel-next',
            sortBy: 'views',
            limit: 10
        }, {
            id: 'editors-pick-carousel',
            prev: 'editors-pick-carousel-prev',
            next: 'editors-pick-carousel-next',
            sortBy: 'createdAt', // Default for now, could be manual picks
            limit: 10
        }];

        // 캐러셀 아이템 렌더링 함수
        function renderCarouselItem(discussion) {
            const defaultImageUrl = `https://placehold.co/150x200/F0F2F5/6B7280?text=No+Image`;
            const imageUrl = discussion.thumbnailImage || defaultImageUrl;
            const categoryText = discussion.category || '기타';
            const viewsCount = discussion.views !== undefined ? discussion.views : 0; // Ensure views exists

            return `
                <div class="carousel-item">
                    <img src="${imageUrl}" alt="${discussion.title}" onerror="this.onerror=null;this.src='${defaultImageUrl}';" loading="lazy">
                    <h3 class="font-medium text-gray-900 text-sm mb-1 text-left">${discussion.title}</h3>
                    <p class="text-xs text-gray-600 text-left font-normal">${discussion.authorNickname || '익명'} - ${categoryText}</p>
                    <div class="flex items-center text-xs text-gray-500 mt-1 justify-start font-normal">
                        <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path></svg>
                        <span>${viewsCount}</span>
                    </div>
                </div>
            `;
        }

        // 캐러셀 탐색 버튼 설정 함수
        function setupCarouselNavigation(carouselId, prevBtnId, nextBtnId) {
            const carousel = document.getElementById(carouselId);
            const prevBtn = document.getElementById(prevBtnId);
            const nextBtn = document.getElementById(nextBtnId);

            if (!carousel || !prevBtn || !nextBtn) {
                console.warn(`Carousel elements not found for ID: ${carouselId}`);
                return;
            }

            const scrollAmount = 200; // 스크롤할 양 (px)

            prevBtn.addEventListener('click', () => {
                carousel.scrollBy({ left: -scrollAmount, behavior: 'smooth' });
            });

            nextBtn.addEventListener('click', () => {
                carousel.scrollBy({ left: scrollAmount, behavior: 'smooth' });
            });

            // 스크롤 위치에 따라 버튼 가시성 업데이트
            const updateButtonVisibility = () => {
                // 이전에 'hidden-button' 클래스를 제거하여 버튼을 다시 보이게 합니다.
                prevBtn.classList.remove('hidden-button');
                nextBtn.classList.remove('hidden-button');

                if (carousel.scrollLeft <= 0) {
                    prevBtn.classList.add('hidden-button');
                }
                // 스크롤 가능한 최대 폭과 현재 스크롤 위치를 비교하여 다음 버튼 가시성 제어
                // 오차 범위(1px)를 두어 스크롤이 끝까지 도달했을 때도 정확히 숨겨지도록 합니다.
                if (carousel.scrollLeft + carousel.clientWidth >= carousel.scrollWidth - 1) {
                    nextBtn.classList.add('hidden-button');
                }
            };

            carousel.addEventListener('scroll', updateButtonVisibility);
            // 초기 로드 시 버튼 가시성 설정
            // setTimeout을 사용하여 이미지 로드 및 레이아웃 계산 후 실행되도록 합니다.
            // 모든 이미지가 로드되기 전에 scrollWidth가 정확하지 않을 수 있기 때문입니다.
            window.addEventListener('load', () => {
                setTimeout(updateButtonVisibility, 500); // 0.5초 지연
            });
            // 창 크기 변경 시에도 버튼 가시성 업데이트 (반응형 대응)
            window.addEventListener('resize', updateButtonVisibility);
        }

        // Firestore에서 토론을 가져와 캐러셀에 렌더링하는 함수
        async function fetchAndRenderDiscussions(carouselId, sortByField, limitCount) {
            const carouselElement = document.getElementById(carouselId);
            if (!carouselElement) {
                console.error(`Carousel element not found: ${carouselId}`);
                return;
            }

            const discussionsCollectionRef = collection(db, `artifacts/${appId}/public/data/discussions`);

            // Firestore 보안 규칙에 따라 orderBy를 직접 사용하지 않고, 모든 문서를 가져와 클라이언트에서 정렬합니다.
            onSnapshot(discussionsCollectionRef, (snapshot) => {
                let discussions = [];
                snapshot.forEach((doc) => {
                    discussions.push({ id: doc.id, ...doc.data() });
                });

                // 데이터 정렬 (클라이언트 측)
                if (sortByField) {
                    discussions.sort((a, b) => {
                        const valA = a[sortByField];
                        const valB = b[sortByField];

                        // Timestamp 필드 처리
                        if (valA && valA.toDate && valB && valB.toDate) {
                            return valB.toDate().getTime() - valA.toDate().getTime(); // 최신순 (내림차순)
                        }
                        // 숫자 필드 (좋아요, 조회수 등) 처리
                        if (typeof valA === 'number' && typeof valB === 'number') {
                            return valB - valA; // 높은 값 순 (내림차순)
                        }
                        // 그 외 (문자열 등)
                        if (valA < valB) return -1;
                        if (valA > valB) return 1;
                        return 0;
                    });
                }

                // 제한된 수량만 표시
                const limitedDiscussions = discussions.slice(0, limitCount);

                carouselElement.innerHTML = limitedDiscussions.map(renderCarouselItem).join('');
            }, (error) => {
                console.error("Error fetching discussions: ", error);
            });
        }
    </script>
</body>
</html>
